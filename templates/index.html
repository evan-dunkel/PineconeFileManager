{% extends "base.html" %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <div class="upload-zone">
            <i data-feather="upload-cloud" class="mb-3" style="width: 48px; height: 48px;"></i>
            <h4>Drag and drop files here</h4>
            <p>or</p>
            <input type="file" id="file-input" class="d-none">
            <button class="btn btn-primary" onclick="document.getElementById('file-input').click()">
                Browse Files
            </button>
            <div class="progress">
                <div class="progress-bar" role="progressbar" style="width: 0%"></div>
            </div>
            <div class="upload-status">
                <i data-feather="loader" class="upload-status-icon"></i>
                <span class="upload-status-text">Uploading file...</span>
            </div>
        </div>
    </div>
</div>

<div class="row file-list">
    <div class="col-md-12">
        <h3>Uploaded Files</h3>
        {% if files %}
            <div class="row">
            {% for file in files %}
                <div class="col-md-4 col-lg-3 mb-4">
                    <div class="file-card">
                        <div class="file-preview">
                            {% if file.thumbnail_path %}
                                <img src="{{ url_for('static', filename=file.thumbnail_path) }}" 
                                     alt="{{ file.filename }}" 
                                     class="img-thumbnail">
                            {% elif file.mime_type == 'application/pdf' %}
                                <a href="{{ url_for('serve_file', file_id=file.id) }}" target="_blank" 
                                   class="text-decoration-none">
                                    <i data-feather="{{ get_file_icon(file.mime_type) }}" 
                                       class="preview-icon text-danger"></i>
                                </a>
                            {% else %}
                                <i data-feather="{{ get_file_icon(file.mime_type) }}" 
                                   class="preview-icon"></i>
                            {% endif %}
                        </div>
                        <div class="file-info">
                            <p class="file-name" title="{{ file.filename }}">{{ file.filename }}</p>
                            <small class="text-muted">
                                {{ file.uploaded_at.strftime('%Y-%m-%d %H:%M:%S') }}
                            </small>
                        </div>
                        <div class="file-actions">
                            {% if file.mime_type == 'application/pdf' %}
                                <a href="{{ url_for('serve_file', file_id=file.id) }}" 
                                   target="_blank"
                                   class="btn btn-sm btn-outline-primary">
                                    <i data-feather="eye"></i>
                                </a>
                            {% endif %}
                            <button class="btn btn-sm btn-outline-primary rename-btn"
                                    data-file-id="{{ file.id }}"
                                    data-file-name="{{ file.filename }}">
                                <i data-feather="edit-2"></i>
                            </button>
                            <form action="{{ url_for('delete_file', file_id=file.id) }}" 
                                  method="POST" 
                                  class="d-inline">
                                <button type="submit" class="btn btn-sm btn-outline-danger"
                                        onclick="return confirm('Are you sure you want to delete this file?')">
                                    <i data-feather="trash-2"></i>
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            {% endfor %}
            </div>
        {% else %}
            <p class="text-muted">No files uploaded yet.</p>
        {% endif %}
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        feather.replace();
    });
</script>
{% endblock %}